<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- -------------------- Configurable Settings -------------------- -->
    <script>
      const CONFIG = {
        imageUrl:
          "https://d17wxfn72dhxb.cloudfront.net/1712316416/assets/414cfc631af74029a81f23fc44ac3f1e.png",

        includeDismissButton: true,

        background: "#B01116",
        revealedBackground: "#B01116",

        enableConfettiOnReveal: true,

        revealButton: {
          enabled: true,
          text: "Reveal My Prize",
          background: "#ffffff",
          color: "#B01116",
        },

        claimButton: {
          enabled: true,
          text: "Claim Now",
          background: "#ffffff",
          color: "#B01116",
          url: "https://www.business-standard.com/subscription-cart/payment?promotionoffer=MTY3JlNBVkU1MDA=&utm_source=CT&utm_medium=webpopup",
        },

        mainTitle: {
          text: "Huge savings unlocked!",
          fontSize: "24px",
          color: "#ffffff",
          textShadow: "0 2px 4px rgba(0,0,0,0.4)",
        },

        subtitle: {
          text: "Scratch the card below to reveal your special offer!",
          fontSize: "14px",
          color: "#ffffff",
        },

        blackFridayTimer: { enabled: false },

        rewards: [
          {
            title: "You Won a Special Offer!",
            value: "SAVE500",
            subtext: "⚡ Save Big: ₹2,700 Plan Now at Only ₹2,200!",
            probability: 1,
          },
        ],
      };
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scratch & Win</title>

    <style>
      * {
        box-sizing: border-box;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        background: transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: "Segoe UI", sans-serif;
      }

      .modal {
        width: 90%;
        max-width: 350px;
        padding: 32px 24px 24px;
        background: #b01116;
        border-radius: 24px;
        text-align: center;
        position: relative;
        color: #ffffff;
        transition: opacity 0.45s ease, transform 0.45s ease;
      }

      .bs-logo {
        font-family: "Times New Roman", serif;
        font-weight: 700;
        font-size: 30px;
        color: #ffffff;
        text-align: center;
        margin-top: 0px;
        margin-bottom: 18px;
        letter-spacing: 0.6px;
        line-height: 1.1;
        max-height: 45px;
        overflow: hidden;
        position: relative;
      }

      .bs-logo img {
        max-height: 45px;
        max-width: 100%;
        width: auto;
        height: auto;
        object-fit: contain;
      }

      .close-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        color: #fff;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        padding: 8px;
        min-width: 40px;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background-color 0.2s ease;
        z-index: 10;
      }

      .close-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      @media (min-width: 600px) {
        .modal {
          max-width: 400px;
          padding: 38px 30px 30px;
        }
      }

      h1 {
        margin: 12px 0;
        font-size: 24px;
        font-weight: 700;
      }

      p {
        margin: 8px 0 16px;
        font-size: 14px;
      }

      canvas.scratcher {
        position: absolute;
        inset: 0;
        border-radius: 16px;
        touch-action: none; /* Prevent touch scrolling */
      }

      .scratch-wrapper {
        width: 100%;
        height: 110px;
        border-radius: 16px;
        border: 3px solid rgba(255, 255, 255, 0.55);
        position: relative;
        overflow: visible;
        margin-top: 10px;
        background: #ffffff;
        cursor: pointer;
        transform-origin: center;
        touch-action: none; /* Prevent touch scrolling */
      }

      .reward {
        position: absolute;
        inset: 0;
        background: #ffffff;
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 26px;
        font-weight: 700;
        color: #b01116;
        overflow: hidden;
      }

      .reward .subtext {
        font-size: 12px;
        font-weight: 500;
        color: #444;
        margin-top: 4px;
      }

      .reveal-btn {
        margin-top: 20px;
        padding: 14px 40px;
        background: #ffffff;
        color: #b01116;
        font-size: 16px;
        font-weight: 700;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        width: 100%;
      }

      @keyframes saveBoomGlow {
        0% {
          transform: scale(0.4);
          text-shadow: 0 0 0 rgba(176, 17, 22, 0);
        }
        50% {
          transform: scale(1.35);
          text-shadow: 0 0 20px rgba(176, 17, 22, 0.7);
        }
        100% {
          transform: scale(1);
          text-shadow: 0 0 0 rgba(176, 17, 22, 0);
        }
      }

      .boomText {
        animation: saveBoomGlow 0.55s ease-out forwards;
      }

      @keyframes redGoldGlow {
        0% {
          box-shadow: 0 0 4px #b01116, 0 0 10px #ffd700;
        }
        50% {
          box-shadow: 0 0 14px #b01116, 0 0 26px #ffd700;
        }
        100% {
          box-shadow: 0 0 4px #b01116, 0 0 10px #ffd700;
        }
      }

      .glow-border {
        animation: redGoldGlow 1.8s infinite ease-in-out;
      }

      /* Pulsating animation for scratch area */
      @keyframes pulsate {
        0% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.05);
        }

        100% {
          transform: scale(1);
        }
      }

      .pulsate-animation {
        animation: pulsate 1.5s 3;
        /* Run 3 times */
      }

      /* Shimmer effect styles */
      :root {
        --shimmer-hue-1: 213deg;
        --shimmer-hue-2: 248deg;
        --shimmer-hue-3: 293deg;
      }

      @property --mask {
        syntax: "<angle>";
        inherits: false;
        initial-value: 33deg;
      }

      @keyframes spin {
        0% {
          --mask: 0deg;
        }
        100% {
          --mask: 360deg;
        }
      }

      .shimmer {
        position: absolute;
        inset: -40px;
        border-radius: inherit;
        mix-blend-mode: plus-lighter;
        pointer-events: none;
        opacity: 0;
        visibility: hidden;
        mask-image: conic-gradient(
          from var(--mask, 0deg),
          transparent 0%,
          transparent 10%,
          black 36%,
          black 45%,
          transparent 50%,
          transparent 60%,
          black 85%,
          black 95%,
          transparent 100%
        );
        mask-size: cover;
        animation: spin 3s linear infinite both -0.5s;
        z-index: 10;
        transition: opacity 0.3s ease-in-out;
      }

      .shimmer::before,
      .shimmer::after {
        content: "";
        border-radius: inherit;
        position: absolute;
        inset: 40px;
        opacity: 1;
      }

      .shimmer::before {
        box-shadow: 0 0 2px 1px hsl(var(--shimmer-hue-1) 60% 95%),
          0 0 5px 3px hsl(var(--shimmer-hue-1) 60% 80%),
          0 0 9px 6px hsl(var(--shimmer-hue-2) 70% 60%),
          0 0 14px 7px hsl(var(--shimmer-hue-2) 50% 40%);
        z-index: -1;
      }

      /* Make the shimmer visible when reward is revealed */
      .scratch-wrapper.shimmer-active .shimmer {
        opacity: 1;
        visibility: visible;
        animation: spin 2s linear infinite;
      }
    </style>
  </head>

  <body>
    <div class="modal" id="modal">
      <div class="bs-logo">
        <img
          src="https://d17wxfn72dhxb.cloudfront.net/1712316416/assets/0dd7278673d0496e9aacd89ef4c0b90b.png"
          alt="Business Standard Logo"
        />
      </div>

      <button class="close-btn" onclick="closePopup()">×</button>

      <div style="width: 160px; margin: 0 auto 10px">
        <img
          src="https://d17wxfn72dhxb.cloudfront.net/1712316416/assets/414cfc631af74029a81f23fc44ac3f1e.png"
          alt="Treasure Chest"
          style="width: 100%; display: block"
        />
      </div>

      <h1 id="mainTitle"></h1>
      <p id="subtitle"></p>

      <div class="scratch-wrapper" id="scratchCard">
        <span class="shimmer"></span>
        <div class="reward" id="reward">
          <span
            id="rewardText"
            style="font-weight: 700; color: #b01116; font-size: 28px"
          ></span>
          <div class="subtext" id="rewardSub"></div>
        </div>

        <canvas class="scratcher"></canvas>
      </div>

      <button class="reveal-btn" id="revealButton">Reveal My Prize</button>
    </div>

    <script>
      (function () {
        const wrapper = document.getElementById("scratchCard");
        const canvas = wrapper.querySelector("canvas");
        const ctx = canvas.getContext("2d");
        const rewardText = document.getElementById("rewardText");
        const rewardSub = document.getElementById("rewardSub");
        const footerButton = document.getElementById("revealButton");

        const reward = CONFIG.rewards[0];

        rewardText.textContent = reward.value;
        rewardSub.textContent = reward.subtext;

        document.getElementById("mainTitle").innerHTML = CONFIG.mainTitle.text;
        document.getElementById("subtitle").textContent = CONFIG.subtitle.text;

        function start(e) {
          e.preventDefault(); // Prevent default touch behavior
          drawing = true;
          draw(e);
        }

        function end(e) {
          e.preventDefault(); // Prevent default touch behavior
          drawing = false;
          checkReveal();
        }

        function draw(e) {
          e.preventDefault(); // Prevent default touch behavior
          if (!drawing) return;
          const p = getPos(e);
          ctx.beginPath();
          ctx.arc(p.x, p.y, 20, 0, Math.PI * 2);
          ctx.fill();
        }

        function resizeCanvas() {
          const rect = wrapper.getBoundingClientRect();
          canvas.width = rect.width;
          canvas.height = rect.height;
          canvas.style.width = rect.width + "px";
          canvas.style.height = rect.height + "px";

          ctx.fillStyle = "#D3D3D3";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.globalCompositeOperation = "destination-out";
        }

        function getPos(e) {
          const r = canvas.getBoundingClientRect();
          const clientX = e.touches ? e.touches[0].clientX : e.clientX;
          const clientY = e.touches ? e.touches[0].clientY : e.clientY;

          return {
            x: (clientX - r.left) * (canvas.width / r.width),
            y: (clientY - r.top) * (canvas.height / r.height),
          };
        }

        function checkReveal() {
          const pixels = ctx.getImageData(
            0,
            0,
            canvas.width,
            canvas.height
          ).data;

          let cleared = 0;

          for (let i = 3; i < pixels.length; i += 4) {
            if (pixels[i] === 0) cleared++;
          }

          if (cleared / (pixels.length / 4) > 0.55) triggerCelebration();
        }

        function triggerCelebration() {
          canvas.style.opacity = "0";
          canvas.style.pointerEvents = "none";

          rewardText.classList.add("boomText");

          document.getElementById("scratchCard").classList.add("glow-border");

          // Add shimmer effect to scratch area
          wrapper.classList.add("shimmer-active");

          // Add pulsating effect to just the reward content
          document.getElementById("reward").classList.add("pulsate-animation");

          firePoppers();
          fireRockets();
          fireCircleBursts();

          footerButton.textContent = CONFIG.claimButton.text;

          footerButton.onclick = () => {
            window.open(
              CONFIG.claimButton.url,
              "_blank",
              "noopener,noreferrer"
            );

            /* ⭐⭐⭐ SPARKLE BURST EXIT - starts here ⭐⭐⭐ */
            setTimeout(() => {
              const modal = document.getElementById("modal");

              // Create sparkle canvas
              const sparkleCanvas = document.createElement("canvas");
              sparkleCanvas.width = modal.offsetWidth;
              sparkleCanvas.height = modal.offsetHeight;
              sparkleCanvas.style.position = "absolute";
              sparkleCanvas.style.top = modal.offsetTop + "px";
              sparkleCanvas.style.left = modal.offsetLeft + "px";
              sparkleCanvas.style.pointerEvents = "none";
              sparkleCanvas.style.zIndex = 99999;
              document.body.appendChild(sparkleCanvas);

              const sCtx = sparkleCanvas.getContext("2d");
              const sparkles = [];

              for (let i = 0; i < 140; i++) {
                sparkles.push({
                  x: sparkleCanvas.width / 2,
                  y: sparkleCanvas.height / 2,
                  size: Math.random() * 3 + 2,
                  color: ["#fff", "#ffd6d6", "#ff5a5a", "#ffe8e8"][
                    Math.floor(Math.random() * 4)
                  ],
                  speedX: (Math.random() - 0.5) * 10,
                  speedY: (Math.random() - 0.5) * 10,
                  alpha: 1,
                });
              }

              modal.style.transform = "scale(0.6)";
              modal.style.opacity = "0";

              function animateSparkles() {
                sCtx.clearRect(0, 0, sparkleCanvas.width, sparkleCanvas.height);

                sparkles.forEach((p) => {
                  p.x += p.speedX;
                  p.y += p.speedY;
                  p.alpha -= 0.02;

                  sCtx.globalAlpha = p.alpha;
                  sCtx.fillStyle = p.color;
                  sCtx.beginPath();
                  sCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                  sCtx.fill();
                });

                if (sparkles.some((p) => p.alpha > 0)) {
                  requestAnimationFrame(animateSparkles);
                } else {
                  sparkleCanvas.remove();
                }
              }

              animateSparkles();

              setTimeout(() => modal.remove(), 600);
            }, 4000);

            /* ⭐⭐⭐ SPARKLE BURST EXIT - ends here ⭐⭐⭐ */
          };
        }

        function firePoppers() {
          const confettiCanvas = document.createElement("canvas");
          confettiCanvas.style.position = "fixed";
          confettiCanvas.style.top = 0;
          confettiCanvas.style.left = 0;
          confettiCanvas.width = window.innerWidth;
          confettiCanvas.height = window.innerHeight;
          confettiCanvas.style.pointerEvents = "none";
          confettiCanvas.style.zIndex = "9999";
          document.body.appendChild(confettiCanvas);

          const c = confettiCanvas.getContext("2d");

          const colors = ["#ffffff", "#FFB3B3", "#FF5A5A", "#B01116"];
          const particles = [];

          for (let i = 0; i < 150; i++) {
            particles.push({
              x: window.innerWidth / 2,
              y: window.innerHeight / 2,
              size: Math.random() * 8 + 4,
              color: colors[Math.floor(Math.random() * colors.length)],
              speedX: (Math.random() - 0.5) * 12,
              speedY: (Math.random() - 0.5) * 12,
              gravity: 0.3,
            });
          }

          function animate() {
            c.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

            particles.forEach((p) => {
              p.x += p.speedX;
              p.y += p.speedY;
              p.speedY += p.gravity;

              c.fillStyle = p.color;
              c.fillRect(p.x, p.y, p.size, p.size);
            });

            if (particles.some((p) => p.y < window.innerHeight)) {
              requestAnimationFrame(animate);
            } else {
              confettiCanvas.remove();
            }
          }

          animate();
        }

        function fireRockets() {
          for (let i = 0; i < 5; i++) {
            const rocket = document.createElement("div");
            rocket.style.position = "fixed";
            rocket.style.bottom = "0";
            rocket.style.left = Math.random() * window.innerWidth + "px";
            rocket.style.width = "4px";
            rocket.style.height = "20px";
            rocket.style.background = "#ffffff";
            rocket.style.borderRadius = "2px";
            rocket.style.zIndex = "9999";
            document.body.appendChild(rocket);

            rocket.animate(
              [
                { transform: "translateY(0)", opacity: 1 },
                { transform: "translateY(-600px)", opacity: 0.2 },
              ],
              { duration: 900, easing: "ease-out" }
            );

            setTimeout(() => rocket.remove(), 1000);
          }
        }

        function fireCircleBursts() {
          const burstCanvas = document.createElement("canvas");
          burstCanvas.style.position = "fixed";
          burstCanvas.style.top = 0;
          burstCanvas.style.left = 0;
          burstCanvas.width = window.innerWidth;
          burstCanvas.height = window.innerHeight;
          burstCanvas.style.pointerEvents = "none";
          burstCanvas.style.zIndex = "9999";
          document.body.appendChild(burstCanvas);

          const ctx2 = burstCanvas.getContext("2d");

          const particles = [];

          for (let j = 0; j < 3; j++) {
            const centerX = Math.random() * window.innerWidth;
            const centerY = Math.random() * window.innerHeight * 0.6;

            for (let i = 0; i < 40; i++) {
              const angle = (Math.PI * 2 * i) / 40;

              particles.push({
                x: centerX,
                y: centerY,
                radius: 3,
                color: ["#ffffff", "#FF5A5A", "#ffcaca"][i % 3],
                speedX: Math.cos(angle) * (Math.random() * 4 + 2),
                speedY: Math.sin(angle) * (Math.random() * 4 + 2),
                fade: 1,
              });
            }
          }

          function animate() {
            ctx2.clearRect(0, 0, burstCanvas.width, burstCanvas.height);

            particles.forEach((p) => {
              p.x += p.speedX;
              p.y += p.speedY;
              p.fade -= 0.02;

              ctx2.beginPath();
              ctx2.globalAlpha = p.fade;
              ctx2.fillStyle = p.color;
              ctx2.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
              ctx2.fill();
            });

            if (particles.some((p) => p.fade > 0)) {
              requestAnimationFrame(animate);
            } else {
              burstCanvas.remove();
            }
          }

          animate();
        }

        canvas.addEventListener("mousedown", start);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", end);
        canvas.addEventListener("mouseleave", end);

        canvas.addEventListener("touchstart", start, { passive: false });
        canvas.addEventListener("touchmove", draw, { passive: false });
        canvas.addEventListener("touchend", end, { passive: false });

        footerButton.addEventListener("click", triggerCelebration);

        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
      })();

      function closePopup() {
        try {
          var overlay =
            window.parent.document.getElementById("intentOpacityDiv");
          var wrapper = window.parent.document.getElementById("intentPreview");
          if (overlay) overlay.remove();
          if (wrapper) wrapper.remove();
        } catch (error) {
          console.error("Error removing parent elements:", error);
        }

        document.getElementById("overlay").style.display = "none";
      }
    </script>
  </body>
</html>
