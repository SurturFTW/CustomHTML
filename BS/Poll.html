<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700;800&family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <title>Premium Poll</title>

    <style>
      /* BACKGROUND */
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: rgba(0, 0, 0, 0.65);
      }

      /* CENTER POPUP */
      .poll-wrapper {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        perspective: 1000px;
        z-index: 9999;
      }

      /* CARD */
      .poll-card {
        width: 300px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 1.2s ease;
      }

      .poll-card.flip {
        transform: rotateY(180deg);
      }

      .poll-face {
        position: absolute;
        width: 100%;
        backface-visibility: hidden;
        background: #ffffff;
        padding: 18px;
        border-radius: 12px;
        box-shadow: 0 18px 35px rgba(0, 0, 0, 0.2);
      }

      /* CLOSE BUTTON */
      .close-btn {
        position: absolute;
        top: 8px;
        right: 10px;
        font-size: 14px;
        cursor: pointer;
        background: none;
        border: none;
        font-weight: 700;
      }

      /* HEADER */
      .poll-header {
        font-family: "Merriweather", serif;
        font-size: 18px;
        font-weight: 800;
        text-align: center;
        color: #000;
        margin-bottom: 8px;
      }

      /* CLEAN RED DIVIDER */
      .separator {
        width: 82%;
        height: 2px;
        background: #b01116;
        margin: 0 auto 16px auto;
        border-radius: 2px;
      }

      /* QUESTION */
      .poll-question {
        font-size: 13px;
        font-weight: 500;
        text-align: center;
        color: #000;
        margin-bottom: 16px;
        line-height: 1.4;
      }

      /* OPTION BARS */
      .option-bar {
        background: #fff4f4;
        border: 2px solid transparent;
        border-radius: 7px;
        margin-bottom: 10px;
        height: 36px;
        position: relative;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 12.5px;
        transition: all 0.2s ease;
      }

      .option-bar.selected {
        border: 2px solid #b01116;
        transform: scale(1.03);
      }

      /* FILL */
      .option-bar .fill {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 0%;
        background: #b01116;
        transition: width 1s ease;
        border-radius: 6px;
      }

      .option-bar span {
        position: relative;
        z-index: 2;
        color: #000;
        transition: color 0.3s ease;
      }

      /* SUBMIT BUTTON */
      .submit-btn {
        width: 100%;
        padding: 9px;
        background: #000;
        color: #fff;
        border: none;
        border-radius: 7px;
        font-weight: 600;
        font-size: 12.5px;
        cursor: pointer;
        margin-top: 4px;
      }

      .submit-btn:hover {
        background: #222;
      }

      /* BACK SIDE */
      .poll-back {
        transform: rotateY(180deg);
        text-align: center;
      }

      /* TICK */
      .tick-circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 2px solid #b01116;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto 12px;
        animation: softGlow 1.5s infinite alternate;
      }

      .tick-circle span {
        font-size: 20px;
        font-weight: bold;
        color: #b01116;
      }

      @keyframes softGlow {
        from {
          box-shadow: 0 0 6px rgba(176, 17, 22, 0.3);
        }
        to {
          box-shadow: 0 0 16px rgba(176, 17, 22, 0.6);
        }
      }

      /* THANK YOU */
      .thank-you {
        font-family: "Merriweather", serif;
        font-size: 16px;
        font-weight: 800;
        color: #b01116;
      }

      .subtext {
        font-size: 12px;
        font-weight: 500;
        color: #000;
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <div class="poll-wrapper" id="poll-wrapper">
      <div class="poll-card" id="pollCard">
        <!-- FRONT -->
        <div class="poll-face">
          <button class="close-btn" onclick="closePoll()">âœ•</button>

          <div class="poll-header">Share your thought</div>
          <div class="separator"></div>

          <div class="poll-question">
            Is the increase in e-way bills a sign of increased economic
            activity?
          </div>

          <div class="option-bar" data-value="yes">
            <div class="fill"></div>
            <span>Yes</span>
          </div>

          <div class="option-bar" data-value="no">
            <div class="fill"></div>
            <span>No</span>
          </div>

          <button class="submit-btn" onclick="submitPoll()">Submit</button>
        </div>

        <!-- BACK -->
        <div class="poll-face poll-back">
          <button class="close-btn" onclick="closePoll()">âœ•</button>

          <div class="tick-circle"><span>âœ“</span></div>
          <div class="thank-you">ðŸŽ‰ Thank you! ðŸŽ‰</div>
          <div class="subtext">We look forward to your next vote!</div>
        </div>
      </div>
    </div>

    <script>
      let selectedOption = null;
      let yesVotes = 60;
      let noVotes = 40;

      document.querySelectorAll(".option-bar").forEach((bar) => {
        bar.addEventListener("click", () => {
          selectedOption = bar.dataset.value;
          document
            .querySelectorAll(".option-bar")
            .forEach((b) => b.classList.remove("selected"));
          bar.classList.add("selected");
        });
      });

      function submitPoll() {
        if (!selectedOption) {
          alert("Please select an option.");
          return;
        }

        // Get the question and answer for tracking
        const question = document
          .querySelector(".poll-question")
          .innerText.trim();
        const answer = selectedOption === "yes" ? "Yes" : "No";

        try {
          // Check if CleverTap is available and properly initialized
          if (
            window.parent.clevertap &&
            window.parent.clevertap.event &&
            window.parent.clevertap.event.push
          ) {
            const props = {
              "Poll Question": question,
              "Poll Answer": answer,
            };
            window.parent.clevertap.event.push("Poll Submitted", props);
          } else {
            console.warn("CleverTap is not available.");
          }
        } catch (e) {
          console.error("CleverTap event push failed:", e);
        }

        if (selectedOption === "yes") {
          yesVotes++;
        } else {
          noVotes++;
        }

        const total = yesVotes + noVotes;
        const yesPercent = Math.round((yesVotes / total) * 100);
        const noPercent = Math.round((noVotes / total) * 100);

        const bars = document.querySelectorAll(".option-bar");

        bars[0].querySelector(".fill").style.width = yesPercent + "%";
        bars[1].querySelector(".fill").style.width = noPercent + "%";

        bars[0].querySelector("span").innerText = "Yes - " + yesPercent + "%";
        bars[1].querySelector("span").innerText = "No - " + noPercent + "%";

        if (yesPercent > 50) {
          bars[0].querySelector("span").style.color = "#fff";
        }
        if (noPercent > 50) {
          bars[1].querySelector("span").style.color = "#fff";
        }

        /* Flip after 3 seconds */
        setTimeout(() => {
          document.getElementById("pollCard").classList.add("flip");

          setTimeout(() => {
            closePoll();
          }, 3000);
        }, 3000);
      }

      function closePoll() {
        try {
          // First try to close parent elements
          var overlay =
            window.parent.document.getElementById("intentOpacityDiv");
          var wrapper = window.parent.document.getElementById("intentPreview");
          if (overlay) overlay.remove();
          if (wrapper) wrapper.remove();
        } catch (error) {
          console.error("Error removing parent elements:", error);
        }
        // Also hide the local overlay as fallback
        document.getElementById("poll-wrapper").style.display = "none";
      }
    </script>
  </body>
</html>
